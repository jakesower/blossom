$schema: http://json-schema.org/draft-07/schema#
description: A representation of a schema for use by polygraph.
type: object
required:
  - resources

properties:
  title:
    type: string
    description: The title of the schema.
  resources:
    type: object
    patternProperties:
      "^([a-z])([A-Za-z0-9_]+)$": { $ref: "#/definitions/resource" }
    minProperties: 1

definitions:
  resource:
    type: object
    required:
      - properties
    properties:
      singular: { type: string }
      properties:
        type: object
        patternProperties:
          "^([a-z])([A-Za-z0-9_]+)$":
            anyOf:
              - { $ref: "#/definitions/relationshipProperty" }
              - { $ref: "#/definitions/nonRelationshipProperty" }
  
  relationshipProperty:
    type: object
    required:
      - type
      - relatedType
      - cardinality
      - inverse
    properties:
      type: { const: relationship }
      relatedType: { type: string }
      cardinality: { enum: ["one", "many"] }
      inverse: { type: string }
  
  nonRelationshipProperty:
    type: object
    required:
      - type
    properties:
      type:
        oneOf:
          - { $ref: "#/definitions/propertyType" }
          - type: array
            minItems: 1
            items: { $ref: "#/definitions/propertyType" }
  
  propertyType:
    type: string
    enum:
      - boolean
      - integer
      - "null"
      - number
      - string
